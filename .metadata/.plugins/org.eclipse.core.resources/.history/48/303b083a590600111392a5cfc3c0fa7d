#include "esp_wifi.h"
#include "bacnet/basic/object/device.h"
#include "bacnet/datalink/datalink.h"
#include "bacnet/basic/services.h"

void bacnet_task(void *pvParameters) {
    /* 1. Set your Device ID (Must be unique on your network) */
    Device_Set_Object_Instance_Number(1234); 

    /* 2. Initialize the BACnet/IP stack */
    bacnet_init();

    printf("BACnet/IP Task Started on Device %d\n", 1234);

    while (1) {
        /* 3. Handle incoming BACnet packets */
        bacnet_task_loop();
        
        /* Yield to other FreeRTOS tasks */
        vTaskDelay(pdMS_TO_TICKS(10)); 
    }
}

void app_main(void) {
    // [Insert your standard Wi-Fi station initialization code here]
    
    // Wait for Wi-Fi connection...
    
    // Once connected, start the BACnet task
    xTaskCreate(bacnet_task, "bacnet_task", 8192, NULL, 5, NULL);
}
