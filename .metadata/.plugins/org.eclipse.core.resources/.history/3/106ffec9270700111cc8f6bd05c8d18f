# components/bacnet/CMakeLists.txt

set(BACNET_SOURCES
    # Core Files (Found in Screenshot ...142055.png)
    "src/bacdcode.c"
    "src/bacint.c"
    "src/bacstr.c"
    "src/bacreal.c"
    "src/bacapp.c"
    "src/bacaddr.c"
    "src/npdu.c"
    "src/apdu.c"
    "src/reject.c"
    "src/fifo.c"
    "src/datetime.c"
    
    # Datalink Files (Found in Screenshot ...142123.png)
    "src/datalink/bip.c"
    "src/datalink/bvlc.c"
    
    # Handlers & Services (Found in src/basic/ folders)
    "src/basic/service/h_rp.c"
    "src/basic/service/s_rp.c"
    "src/basic/service/h_wp.c"
    "src/basic/service/s_wp.c"
    "src/basic/service/h_noserv.c"
    "src/basic/npdu/h_npdu.c"
    "src/basic/tsm/tsm.c"
    "src/basic/object/device.c"
)

idf_component_register(
    SRCS ${BACNET_SOURCES}
    # Multiple include paths to ensure "bacapp.h" is found everywhere
    INCLUDE_DIRS "include" "include/bacnet" "src" "src/basic/object" "src/basic/service"
    REQUIRES lwip esp_wifi esp_netif driver esp_timer nvs_flash
)

# Critical: Suppress errors and optimize for size to prevent DRAM overflow
target_compile_options(${COMPONENT_LIB} PRIVATE 
    -Wno-error -w -ffunction-sections -fdata-sections
)