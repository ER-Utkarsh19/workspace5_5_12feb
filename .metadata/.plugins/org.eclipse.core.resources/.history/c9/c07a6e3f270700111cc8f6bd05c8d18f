# components/bacnet/CMakeLists.txt

# 1. Manually set the sources with corrected paths
# Check your folders: if apdu.c is in "src/bacnet/apdu.c", use that path.
set(BACNET_SOURCES
    "src/bacnet/bacdcode.c"
    "src/bacnet/bacint.c"
    "src/bacnet/bacstr.c"
    "src/bacnet/bacreal.c"
    "src/bacnet/bacapp.c"
    "src/bacnet/bacaddr.c"
    "src/bacnet/npdu.c"
    "src/bacnet/apdu.c"
    "src/bacnet/reject.c"
    "src/bacnet/fifo.c"
    "src/bacnet/datetime.c"
    
    # Datalink
    "src/bacnet/datalink/bip.c"
    "src/bacnet/datalink/bvlc.c"
    
    # Basic Objects
    "src/bacnet/basic/object/device.c"
    "src/bacnet/basic/object/ai.c"
    "src/bacnet/basic/object/ao.c"
    "src/bacnet/basic/object/av.c"
    "src/bacnet/basic/object/bi.c"
    "src/bacnet/basic/object/bo.c"
    "src/bacnet/basic/object/bv.c"
    
    # Basic Services
    "src/bacnet/basic/service/h_rp.c"
    "src/bacnet/basic/service/s_rp.c"
    "src/bacnet/basic/service/h_wp.c"
    "src/bacnet/basic/service/s_wp.c"
    "src/bacnet/basic/service/h_noserv.c"
    "src/bacnet/basic/npdu/h_npdu.c"
    "src/bacnet/basic/tsm/tsm.c"
)

idf_component_register(
    SRCS ${BACNET_SOURCES}
    INCLUDE_DIRS "include" "include/bacnet" "src"
    REQUIRES lwip esp_wifi esp_netif driver esp_timer nvs_flash
)

# Suppress warnings and optimize size
target_compile_options(${COMPONENT_LIB} PRIVATE 
    -Wno-error -w -ffunction-sections -fdata-sections
)